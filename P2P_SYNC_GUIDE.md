# P2P 图库同步功能使用指南

## 🎯 功能概述

现在你的 ImageWall 应用已经集成了完整的 P2P 图库同步功能，可以将数据库(test2.db)和所有图片从一个设备传输到另一个设备。

## 📋 使用步骤

### 1. 启动信令服务器
首先需要启动本地信令服务器：
```bash
cd ../signaling-server
npm install
npm start
```

### 2. 启动两个应用实例
```bash
# 在当前目录启动第一个实例
npm start
```

然后在另一个浏览器窗口或设备上打开 `http://localhost:3000`

### 3. 建立P2P连接
1. 点击右上角的"设备同步"按钮
2. 切换到"P2P通信"标签页
3. 复制其中一个设备的设备ID
4. 在另一个设备上输入该ID并点击"连接设备"

### 4. 开始同步
连接成功后：
1. 在**发送方设备**上找到"📁 图库同步功能"区域
2. 点击"🔄 开始图库同步"按钮
3. 在弹出的同步管理器中选择目标设备
4. 点击"开始同步"

### 5. 监控同步进度
系统会显示实时的同步进度：
- 📊 进度条显示当前传输进度
- 📋 日志窗口显示详细的传输信息
- 🔢 数字显示已传输的图片数量

## 🔄 同步流程

1. **数据库传输** - 首先传输 test2.db 文件
2. **图片传输** - 逐个传输所有图片文件
3. **自动应用** - 接收完成后自动保存并询问是否刷新页面

## ⚡ 技术特点

- **分块传输**: 大文件自动分成16KB块进行传输
- **进度监控**: 实时显示传输进度和状态
- **错误处理**: 完善的错误提示和重试机制
- **局域网优化**: 针对同一WiFi网络优化传输速度

## 🔧 故障排除

### 连接问题
- 确保信令服务器正在运行 (localhost:9001)
- 检查两个设备是否在同一网络下
- 尝试刷新页面重新建立连接

### 传输问题
- 确保发送方有图片数据
- 检查浏览器控制台是否有错误信息
- 大量图片传输可能需要较长时间，请耐心等待

### 数据库问题
- 接收完成后请刷新页面以应用新的数据库
- 如果页面没有显示新图片，检查浏览器的本地存储

## 🎉 使用提示

1. **首次使用**: 建议先用少量图片测试功能
2. **网络环境**: 确保在稳定的WiFi环境下使用
3. **设备性能**: 大量图片传输可能占用较多内存和CPU
4. **备份数据**: 重要数据建议在同步前进行备份

## 📖 技术说明

- 使用 WebRTC 技术实现点对点传输
- 支持局域网直连，无需外网流量
- 基于 PeerJS 库简化 WebRTC 操作
- 数据库使用 SQLite (WebAssembly 版本)
- 图片存储在 IndexedDB 中

---

🎯 **开始体验** P2P 图库同步功能，让你的图片在设备间无缝传输！ 